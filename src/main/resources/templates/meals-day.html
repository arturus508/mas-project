<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Meals · Day</title>
  <link  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"  rel="stylesheet">
</head>
<body class="bg-light">
<div class="container  py-4">

  <div class="d-flex  align-items-center  justify-content-between  mb-3">
    <h3 class="m-0">Meals · <span th:text="${date}">2025-08-03</span></h3>
    <div class="d-flex  gap-2">
      <form method="get" action="/meal-plans/day" class="d-flex gap-2">
        <input type="date" class="form-control" name="date" th:value="${date}">
        <input type="text"  class="form-control" name="q" placeholder="search food" th:value="${q}">
        <button class="btn btn-outline-primary">Go</button>
      </form>
      <form method="post" action="/meal-plans/day/copy-yesterday">
        <div th:replace="fragments/csrf :: csrf"></div>
        <input type="hidden" name="date" th:value="${date}">
        <button class="btn btn-outline-secondary">Copy yesterday</button>
      </form>
    </div>
  </div>

  <div class="row  g-3">
    <div class="col-12 col-lg-6">
      <div th:replace="${'~{::mealCard(''BREAKFAST'', breakfast, totB, date, foods, q)}'}"></div>
    </div>
    <div class="col-12 col-lg-6">
      <div th:replace="${'~{::mealCard(''LUNCH'', lunch, totL, date, foods, q)}'}"></div>
    </div>
    <div class="col-12 col-lg-6">
      <div th:replace="${'~{::mealCard(''DINNER'', dinner, totD, date, foods, q)}'}"></div>
    </div>
    <div class="col-12 col-lg-6">
      <div th:replace="${'~{::mealCard(''SNACK'', snack, totS, date, foods, q)}'}"></div>
    </div>
  </div>

  <div class="mt-4">
    <div class="card">
      <div class="card-body">
        <strong>Day total</strong> :
        kcal <span th:text="${totDay['kcal']}">0</span>  ·
        P <span th:text="${totDay['protein']}">0</span> g  ·
        F <span th:text="${totDay['fat']}">0</span> g  ·
        C <span th:text="${totDay['carbs']}">0</span> g
      </div>
    </div>
  </div>

</div>

<th:block th:fragment="mealCard(title, meal, tot, date, foods, q)">
  <div class="card h-100">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div><strong th:text="${title}">BREAKFAST</strong></div>
      <div class="text-muted small">
        kcal <span th:text="${tot['kcal']}">0</span>  ·
        P <span th:text="${tot['protein']}">0</span>  ·
        F <span th:text="${tot['fat']}">0</span>  ·
        C <span th:text="${tot['carbs']}">0</span>
      </div>
    </div>
    <div class="card-body">
      <ul class="list-group  list-group-flush  mb-3">
        <li class="list-group-item d-flex justify-content-between align-items-center"
            th:each="it : ${meal.items}">
          <div>
            <div th:text="${it.foodItem.name}">Chicken</div>
            <div class="text-muted small">
              <span th:text="${it.quantity}">100</span>
              <span th:text="${it.foodItem.unit}">g</span>
            </div>
          </div>
          <form method="post" th:action="@{'/meal-plans/day/remove-item/' + ${it.id}}">
            <div th:replace="fragments/csrf :: csrf"></div>
            <input type="hidden" name="date" th:value="${date}">
            <button class="btn btn-sm btn-outline-danger">Remove</button>
          </form>
        </li>
        <li class="list-group-item text-muted text-center" th:if="${#lists.isEmpty(meal.items)}">No items</li>
      </ul>

      <form class="row g-2 align-items-end" method="post" th:action="@{'/meal-plans/day/' + ${meal.id} + '/add-item'}">
        <div th:replace="fragments/csrf :: csrf"></div>
        <input type="hidden" name="date" th:value="${date}">
        <div class="col-12 col-md">
          <label class="form-label">Food</label>
          <select class="form-select" name="foodItemId">
            <option th:each="f : ${foods}" th:value="${f.id}"
                    th:text="${f.name + '  ·  ' + f.unit + '  ·  ' + f.kcal100 + 'kcal/100' }">Food</option>
          </select>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label">Qty</label>
          <input type="number" class="form-control" name="quantity" min="1" value="100">
        </div>
        <div class="col-6 col-md-2">
          <button class="btn btn-primary w-100">Add</button>
        </div>
      </form>

      <div class="border-top  mt-3  pt-3">
        <div class="text-muted small mb-2">Quick meal (override totals)</div>
        <form class="row g-2" method="post" th:action="@{'/meal-plans/day/' + ${meal.id} + '/quick'}">
          <div th:replace="fragments/csrf :: csrf"></div>
          <input type="hidden" name="date" th:value="${date}">
          <div class="col-3"><input class="form-control" name="kcal"   type="number" min="0" placeholder="kcal"></div>
          <div class="col-3"><input class="form-control" name="protein" type="number" min="0" placeholder="P"></div>
          <div class="col-3"><input class="form-control" name="fat"     type="number" min="0" placeholder="F"></div>
          <div class="col-3"><input class="form-control" name="carbs"   type="number" min="0" placeholder="C"></div>
          <div class="col-12"><button class="btn btn-outline-secondary w-100">Set quick meal</button></div>
        </form>
      </div>
    </div>
  </div>
</th:block>

</body>
</html>
