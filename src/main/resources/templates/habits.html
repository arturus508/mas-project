<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}"></head>
<body>
<div th:replace="~{fragments/nav :: nav}"></div>

<div class="container" style="max-width: 980px; margin-top: 24px;">
  <h2>Habits â€” streak + mini heatmap (28d)</h2>

  <form method="get" action="#" style="margin:8px 0 16px;">
    <label for="date">Reference date:</label>
    <input id="date" name="date" type="date" th:value="${date}">
    <button type="submit">Go</button>
    <span style="font-size:12px; color:#666; margin-left:8px;">Heatmap koÅ„czy siÄ™ w tej dacie</span>
  </form>

  <style>
    .heat{ display:flex; gap:4px; align-items:center; }
    .cell{ width:14px; height:14px; border:1px solid #d0d7de; background:#fff; border-radius:3px; padding:0; }
    .cell.on{ background:#2ea043; border-color:#2ea043; }
    .cell:focus{ outline:1px solid #57606a; }
    .name{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:420px; }
    .row{ display:grid; grid-template-columns: 1fr auto; align-items:center; gap:8px; padding:8px 0; border-bottom:1px solid #f0f0f0; }
    .streak{ font-size:12px; color:#666; }
    .target{ font-weight:600; margin-left:6px; color:#444; }
  </style>

  <div style="margin: 12px 0; padding: 12px; border:1px solid #ddd; border-radius:8px;">
    <h3 style="margin:0 0 8px;">Add habit</h3>
    <form method="post" th:action="@{/flow/habits}">
      <div th:replace="~{fragments/csrf :: csrf}"></div>
      <input type="hidden" name="date" th:value="${date}">
      <div style="display:grid; grid-template-columns: 1fr 140px auto; gap:8px;">
        <input name="name" placeholder="Habit name" required>
        <input name="targetPerDay" type="number" min="1" value="1">
        <button type="submit">Add</button>
      </div>
    </form>
  </div>

  <h3 style="margin: 12px 0 6px;">Your habits</h3>
  <div th:if="${#lists.isEmpty(habits)}" style="color:#666;">No habits yet.</div>

  <div th:each="h : ${habits}" class="row">
    <div class="name">
      <strong th:text="${h.name}">Habit</strong>
      <span class="target"
            th:text="' Ã—' + ${h.targetPerDay}"
            th:title="${h.targetPerDay} + (${h.targetPerDay}==1 ? ' time' : ' times')"> Ã—1</span>
      <span class="streak"> â€¢ ðŸ”¥ <span th:text="${streaks[h.id]}">0</span> day streak</span>
    </div>

    <div style="display:flex; gap:8px; align-items:center; justify-content:flex-end;">
      <form method="post" th:action="@{/flow/habits/toggle/{id}(id=${h.id})}" style="display:inline;">
        <div th:replace="~{fragments/csrf :: csrf}"></div>
        <input type="hidden" name="date" th:value="${date}">
        <input type="hidden" name="refDate" th:value="${date}">
        <button type="submit"
                style="width:26px; height:26px; border:1px solid #bbb; border-radius:4px; background:#fff;"
                th:text="${today[h.id]} ? 'âœ“' : ''" aria-label="toggle today"></button>
      </form>

      <form method="post" th:action="@{/flow/habits/{id}/delete(id=${h.id})}" style="display:inline;">
        <div th:replace="~{fragments/csrf :: csrf}"></div>
        <input type="hidden" name="date" th:value="${date}">
        <button type="submit">Delete</button>
      </form>
    </div>

    <div class="heat" style="grid-column: 1 / -1;">
      <div th:each="d : ${windowDays}" style="display:inline;">
        <form method="post" th:action="@{/flow/habits/toggle/{id}(id=${h.id})}" style="display:inline;">
          <div th:replace="~{fragments/csrf :: csrf}"></div>
          <input type="hidden" name="date"    th:value="${#temporals.format(d,'yyyy-MM-dd')}">
          <input type="hidden" name="refDate" th:value="${date}">
          <button type="submit" class="cell"
                  th:classappend="${heat[h.id][#temporals.format(d,'yyyy-MM-dd')]} ? ' on' : ''"
                  th:title="${#temporals.format(d,'EEE, yyyy-MM-dd')}"></button>
        </form>
      </div>
    </div>
  </div>
</div>

</body>
</html>






