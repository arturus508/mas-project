<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/head :: head('Dream journal')}"></head>
<body class="bg-light">

<nav th:replace="~{fragments/nav :: nav}"></nav>

<main class="container py-4">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <h2 class="m-0">Dream journal</h2>
    <form class="d-flex flex-wrap gap-2" method="get" th:action="@{/mind/dreams}">
      <input type="date" class="form-control" name="from" th:value="${from}">
      <input type="date" class="form-control" name="to" th:value="${to}">
      <input type="text" class="form-control" name="tag" placeholder="tag" th:value="${tag}">
      <button class="btn btn-outline-primary">Search</button>
    </form>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-7">
      <div class="card h-100">
        <div class="card-header">Entries</div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item" th:each="d : ${dreams}">
            <div class="d-flex justify-content-between align-items-start gap-3">
              <div>
                <div class="fw-semibold" th:text="${d.title}">Title</div>
                <div class="text-muted small">
                  <span th:text="${d.date}">2025-08-03</span>
                  <span th:if="${d.tags != null and !#strings.isEmpty(d.tags)}">
                    | Tags: <span th:text="${d.tags}">tag1, tag2</span>
                  </span>
                  <span th:if="${d.mood != null}">
                    | Mood: <span th:text="${d.mood}">3</span>
                  </span>
                  <span class="badge text-bg-info ms-1" th:if="${d.lucid}">Lucid</span>
                  <span class="badge text-bg-warning ms-1" th:if="${d.nightmare}">Nightmare</span>
                </div>
              </div>
              <form th:action="@{|/mind/dreams/${d.id}/delete|}" method="post">
                <div th:replace="~{fragments/csrf :: csrf}"></div>
                <input type="hidden" name="from" th:value="${from}">
                <input type="hidden" name="to" th:value="${to}">
                <input type="hidden" name="tag" th:value="${tag}">
                <button class="btn btn-outline-danger btn-sm">Delete</button>
              </form>
            </div>
            <div class="mt-2 small" th:text="${d.content}">...</div>
          </li>
          <li class="list-group-item text-muted text-center" th:if="${#lists.isEmpty(dreams)}">No dreams yet</li>
        </ul>
      </div>
    </div>

    <div class="col-12 col-lg-5">
      <div class="card h-100">
        <div class="card-header">Add dream</div>
        <div class="card-body">
          <form th:action="@{/mind/dreams/add}" th:object="${dreamForm}" method="post" class="row g-2">
            <div th:replace="~{fragments/csrf :: csrf}"></div>
            <input type="hidden" name="from" th:value="${from}">
            <input type="hidden" name="to" th:value="${to}">
            <input type="hidden" name="tag" th:value="${tag}">
            <div class="col-12" th:if="${#fields.hasErrors('*')}">
              <div class="alert alert-danger py-2">
                <div th:each="err : ${#fields.errors('*')}" th:text="${err}">Invalid input</div>
              </div>
            </div>
            <div class="col-12">
              <label class="form-label" for="date">Date</label>
              <input id="date" type="date" th:field="*{date}" class="form-control">
              <div class="text-danger small" th:if="${#fields.hasErrors('date')}" th:errors="*{date}"></div>
            </div>
            <div class="col-12">
              <label class="form-label" for="title">Title</label>
              <input id="title" type="text" th:field="*{title}" class="form-control">
              <div class="text-danger small" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></div>
            </div>
            <div class="col-12">
              <label class="form-label" for="content">Content</label>
              <textarea id="content" th:field="*{content}" class="form-control" rows="5"></textarea>
              <div class="text-danger small" th:if="${#fields.hasErrors('content')}" th:errors="*{content}"></div>
            </div>
            <div class="col-12">
              <label class="form-label" for="tags">Tags (comma separated)</label>
              <input id="tags" type="text" th:field="*{tags}" class="form-control">
              <div class="text-danger small" th:if="${#fields.hasErrors('tags')}" th:errors="*{tags}"></div>
            </div>
            <div class="col-12">
              <label class="form-label" for="mood">Mood (1-5)</label>
              <input id="mood" type="number" th:field="*{mood}" class="form-control" min="1" max="5" step="1">
              <div class="text-danger small" th:if="${#fields.hasErrors('mood')}" th:errors="*{mood}"></div>
            </div>
            <div class="col-12">
              <label class="form-label" for="sleepEntryId">Sleep entry id (optional)</label>
              <input id="sleepEntryId" type="number" th:field="*{sleepEntryId}" class="form-control">
              <div class="text-danger small" th:if="${#fields.hasErrors('sleepEntryId')}" th:errors="*{sleepEntryId}"></div>
            </div>
            <div class="col-12">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" th:field="*{lucid}" id="lucid">
                <label class="form-check-label" for="lucid">Lucid</label>
              </div>
            </div>
            <div class="col-12">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" th:field="*{nightmare}" id="nightmare">
                <label class="form-check-label" for="nightmare">Nightmare</label>
              </div>
            </div>
            <div class="col-12">
              <button class="btn btn-success">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <a href="/mind/sleep" class="btn btn-outline-secondary">Back to Sleep</a>
    <a href="/today" class="btn btn-outline-secondary">Back to Today</a>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

