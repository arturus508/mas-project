<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Today')}"></head>
<body>
<div th:replace="~{fragments/nav :: nav}"></div>

<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h3 mb-1">Today</h1>
      <div class="text-muted" th:text="${#temporals.format(vm.date, 'yyyy-MM-dd')}">2025-01-01</div>
    </div>
    <div class="btn-group">
      <a class="btn btn-outline-secondary btn-sm"
         th:href="@{/today/{date}(date=${vm.date.minusDays(1)})}">Prev</a>
      <a class="btn btn-outline-secondary btn-sm"
         th:href="@{/today/{date}(date=${vm.date.plusDays(1)})}">Next</a>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header">Plan</div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <div class="fw-semibold">Top Tasks</div>
              <div class="text-muted small"
                   th:text="${vm.tasksDone + '/' + vm.tasksTotal}">0/0</div>
            </div>
            <a class="btn btn-sm btn-outline-primary" th:href="@{/flow/tasks}">Open</a>
          </div>
          <div class="mb-3">
            <div class="text-muted small" th:if="${#lists.isEmpty(vm.topTasks)}">No tasks for this day.</div>
            <div class="list-group list-group-flush" th:if="${!#lists.isEmpty(vm.topTasks)}">
              <div class="list-group-item d-flex align-items-center gap-2"
                   th:each="t : ${vm.topTasks}">
                <form th:action="@{/today/{date}/tasks/{id}/toggle(date=${vm.date},id=${t.id})}"
                      method="post" class="m-0">
                  <div th:replace="~{fragments/csrf :: csrf}"></div>
                  <input class="form-check-input" type="checkbox" th:checked="${t.done}" onchange="this.form.submit()">
                </form>
                <span th:text="${t.title}" th:classappend="${t.done} ? 'text-decoration-line-through text-muted' : ''">Task</span>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <div class="fw-semibold">Habits</div>
              <div class="text-muted small"
                   th:text="${vm.habitsDone + '/' + vm.habitsTotal}">0/0</div>
            </div>
            <a class="btn btn-sm btn-outline-primary" th:href="@{/flow/habits}">Open</a>
          </div>
          <div class="text-muted small" th:if="${#lists.isEmpty(vm.habits)}">No habits yet.</div>
          <div class="list-group list-group-flush" th:if="${!#lists.isEmpty(vm.habits)}">
            <div class="list-group-item d-flex align-items-center gap-2"
                 th:each="h : ${vm.habits}">
              <form th:action="@{/today/{date}/habits/{id}/toggle(date=${vm.date},id=${h.id})}"
                    method="post" class="m-0">
                <div th:replace="~{fragments/csrf :: csrf}"></div>
                <input class="form-check-input" type="checkbox" th:checked="${h.done}" onchange="this.form.submit()">
              </form>
              <span th:text="${h.name}" th:classappend="${h.done} ? 'text-decoration-line-through text-muted' : ''">Habit</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header">Track</div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <div class="fw-semibold">Meals</div>
              <div class="text-muted small" th:with="tot=${vm.mealTotals}">
                <span>kcal </span>
                <span th:text="${tot != null ? tot.kcal : 0}">0</span>
                <span> | P </span>
                <span th:text="${tot != null ? tot.protein : 0}">0</span>
                <span> / C </span>
                <span th:text="${tot != null ? tot.carbs : 0}">0</span>
                <span> / F </span>
                <span th:text="${tot != null ? tot.fat : 0}">0</span>
              </div>
            </div>
            <a class="btn btn-sm btn-outline-primary" th:href="@{/meals/today}">Open</a>
          </div>
          <div class="d-flex flex-wrap gap-2 mb-3">
            <a class="btn btn-sm btn-outline-secondary"
               th:href="@{/meals/{date}/breakfast(date=${vm.date})}">Breakfast</a>
            <a class="btn btn-sm btn-outline-secondary"
               th:href="@{/meals/{date}/lunch(date=${vm.date})}">Lunch</a>
            <a class="btn btn-sm btn-outline-secondary"
               th:href="@{/meals/{date}/dinner(date=${vm.date})}">Dinner</a>
            <a class="btn btn-sm btn-outline-secondary"
               th:href="@{/meals/{date}/snacks(date=${vm.date})}">Snacks</a>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <div class="fw-semibold">Workout</div>
              <div class="text-muted small" th:if="${vm.workoutTitle != null}"
                   th:text="${vm.workoutTitle + ' • ' + vm.workoutSetsDone + '/' + vm.workoutSetsTotal + ' sets'}">
                Workout • 0/0 sets
              </div>
              <div class="text-muted small" th:if="${vm.workoutTitle == null}">
                No workout logged today
              </div>
            </div>
            <a class="btn btn-sm btn-outline-primary" th:href="@{/workouts/today}">Open</a>
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-semibold">Sleep (Last Night)</div>
              <div class="text-muted small" th:if="${vm.sleepHours != null}"
                   th:text="${vm.sleepHours + 'h ' + vm.sleepMinutes + 'm • quality ' + vm.sleepQuality}">
                0h 0m • quality 0
              </div>
              <div class="text-muted small" th:if="${vm.sleepHours == null}">
                No sleep logged for last night
              </div>
            </div>
            <a class="btn btn-sm btn-outline-primary" th:href="@{/mind/sleep}">Open</a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header">Reset</div>
        <div class="card-body">
          <p class="text-muted mb-3">Quick reset for stressful moments.</p>
          <a class="btn btn-outline-primary" th:href="@{/mind/stress-relief}">2-minute reset</a>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header">Review</div>
        <div class="card-body">
          <p class="text-muted mb-0">Daily review is coming next (mood, energy, short note).</p>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
